
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Simple and intuitive visual simple function fitter.">
      
      
      
        <link rel="canonical" href="https://QuanticPony.github.io/compartmental/reference/compartmental/util/">
      
      
        <link rel="prev" href="../generic_model/">
      
      
        <link rel="next" href="../parameters/parameters_manager/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.8">
    
    
      
        <title>Util - compartmental</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.ded33207.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="grey">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#compartmental.util" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="compartmental" class="md-header__button md-logo" aria-label="compartmental" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            compartmental
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Util
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="grey"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="grey"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 2c-1.05 0-2.05.16-3 .46 4.06 1.27 7 5.04 7 9.54 0 4.5-2.94 8.27-7 9.54.95.3 1.95.46 3 .46a10 10 0 0 0 10-10A10 10 0 0 0 9 2Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/QuanticPony/compartmental" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    QuanticPony/compartmental
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="compartmental" class="md-nav__button md-logo" aria-label="compartmental" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    compartmental
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/QuanticPony/compartmental" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    QuanticPony/compartmental
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../LICENSE/" class="md-nav__link">
        License
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Code Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Code Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          Compartmental
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Compartmental
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../generic_model/" class="md-nav__link">
        Generic model
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Util
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Util
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#compartmental.util" class="md-nav__link">
    compartmental.util
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.auto_adjust_model_params" class="md-nav__link">
    auto_adjust_model_params()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.get_best_parameters" class="md-nav__link">
    get_best_parameters()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.get_model_sample_trajectory" class="md-nav__link">
    get_model_sample_trajectory()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.get_model_sample_trajectory_with_diff_to_reference" class="md-nav__link">
    get_model_sample_trajectory_with_diff_to_reference()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.get_percentiles_from_results" class="md-nav__link">
    get_percentiles_from_results()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.get_trajecty_selector" class="md-nav__link">
    get_trajecty_selector()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.load_parameters" class="md-nav__link">
    load_parameters()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.offset_array" class="md-nav__link">
    offset_array()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.progress_bar" class="md-nav__link">
    progress_bar()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.save_parameters" class="md-nav__link">
    save_parameters()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.save_parameters_no_diff" class="md-nav__link">
    save_parameters_no_diff()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.weighted_quantile" class="md-nav__link">
    weighted_quantile()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
          Parameters
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1_3">
          <span class="md-nav__icon md-icon"></span>
          Parameters
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../parameters/parameters_manager/" class="md-nav__link">
        Parameters manager
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/MY_MODEL/" class="md-nav__link">
        MY MODEL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/SEIR/" class="md-nav__link">
        SEIR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/SIR/" class="md-nav__link">
        SIR
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#compartmental.util" class="md-nav__link">
    compartmental.util
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.auto_adjust_model_params" class="md-nav__link">
    auto_adjust_model_params()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.get_best_parameters" class="md-nav__link">
    get_best_parameters()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.get_model_sample_trajectory" class="md-nav__link">
    get_model_sample_trajectory()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.get_model_sample_trajectory_with_diff_to_reference" class="md-nav__link">
    get_model_sample_trajectory_with_diff_to_reference()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.get_percentiles_from_results" class="md-nav__link">
    get_percentiles_from_results()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.get_trajecty_selector" class="md-nav__link">
    get_trajecty_selector()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.load_parameters" class="md-nav__link">
    load_parameters()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.offset_array" class="md-nav__link">
    offset_array()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.progress_bar" class="md-nav__link">
    progress_bar()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.save_parameters" class="md-nav__link">
    save_parameters()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.save_parameters_no_diff" class="md-nav__link">
    save_parameters_no_diff()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compartmental.util.weighted_quantile" class="md-nav__link">
    weighted_quantile()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Util</h1>

<!-- Copyright 2023 Unai Lería Fortea

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License. -->


<div class="doc doc-object doc-module">


<a id="compartmental.util"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="compartmental.util.auto_adjust_model_params" class="doc doc-heading">
<code class="highlight language-python"><span class="n">auto_adjust_model_params</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Adjusts limits of model params. If <code>params</code> is specified only those are adjusted.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="compartmental.generic_model.GenericModel" href="../generic_model/#compartmental.generic_model.GenericModel">GenericModel</a></code>
          </td>
          <td><p>Model to optimize.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>results</code></td>
          <td>
                <code>list[list[float]]</code>
          </td>
          <td><p>Results from running the model.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>weights</code></td>
          <td>
                <code>list[float]</code>
          </td>
          <td><p>Results weights. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>params</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>Names of params to optimice. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>compartmental/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="k">def</span> <span class="nf">auto_adjust_model_params</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">GenericModel</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjusts limits of model params. If `params` is specified only those are adjusted.</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">        model (GenericModel): Model to optimize.</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">        results (list[list[float]]): Results from running the model.</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">        weights (list[float], optional): Results weights. Defaults to None.</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">        params (list[str], optional): Names of params to optimice. Defaults to None.</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="n">percentile</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">p</span><span class="p">:</span> <span class="n">weighted_quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="n">percentile</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">p</span><span class="p">:</span> <span class="n">CNP</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">param_to_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="n">aux</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">_5</span> <span class="o">=</span> <span class="n">percentile</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="n">_50</span> <span class="o">=</span> <span class="n">percentile</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="n">_95</span> <span class="o">=</span><span class="n">percentile</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="n">M</span><span class="p">:</span><span class="nb">dict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="n">distm</span> <span class="o">=</span> <span class="n">_50</span> <span class="o">-</span> <span class="n">_5</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="n">distM</span> <span class="o">=</span> <span class="n">_95</span> <span class="o">-</span> <span class="n">_50</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="n">TYPE</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">)</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="k">if</span> <span class="s2">&quot;int&quot;</span> <span class="ow">in</span> <span class="n">TYPE</span><span class="p">:</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="n">MIN</span> <span class="o">=</span> <span class="n">_5</span> <span class="o">-</span> <span class="mi">1</span> 
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="n">MAX</span> <span class="o">=</span> <span class="n">_95</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="k">else</span> <span class="p">:</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>            <span class="n">MIN</span> <span class="o">=</span> <span class="n">_5</span> <span class="o">*</span> <span class="mf">0.5</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="n">MAX</span> <span class="o">=</span> <span class="n">_95</span> <span class="o">*</span> <span class="mi">2</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="n">min_probable_value</span> <span class="o">=</span> <span class="n">_5</span> <span class="o">-</span> <span class="n">distM</span> <span class="k">if</span> <span class="n">distM</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">MAX</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="n">max_probable_value</span> <span class="o">=</span> <span class="n">_95</span> <span class="o">+</span> <span class="n">distm</span> <span class="k">if</span> <span class="n">distm</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">MIN</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="c1"># print(f&quot;&quot;&quot;{c}:</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="c1">#     min: {min_probable_value},\t {0.9 * (M[&quot;min&quot;]*4+_5)/5},\t {M.get(&quot;min_limit&quot;, None)}</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="c1">#     max: {max_probable_value},\t {1.1 * (M[&quot;max&quot;]*4+_95)/5},\t {M.get(&quot;max_limit&quot;, None)}</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="c1">#     &quot;&quot;&quot;)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="c1"># TODO: make a gaussian kernel to infer when probability is 0 and assing as min or max</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="n">MAX</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_limit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="n">MIN</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min_limit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">MAX</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">MIN</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>                <span class="s2">&quot;min&quot;</span> <span class="p">:</span> <span class="n">CNP</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">min_probable_value</span><span class="p">,</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">_5</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="n">MIN</span><span class="p">,</span> <span class="n">MAX</span><span class="p">),</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                <span class="s2">&quot;max&quot;</span> <span class="p">:</span> <span class="n">CNP</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">max_probable_value</span><span class="p">,</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">_95</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="n">MIN</span><span class="p">,</span> <span class="n">MAX</span><span class="p">)</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="p">})</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>            <span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                <span class="s2">&quot;min&quot;</span> <span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">min_probable_value</span><span class="p">,</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">_5</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                <span class="s2">&quot;max&quot;</span> <span class="p">:</span><span class="nb">max</span><span class="p">(</span><span class="n">max_probable_value</span><span class="p">,</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">_95</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>            <span class="p">})</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="compartmental.util.get_best_parameters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_best_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">log_diff</span><span class="p">,</span> <span class="n">save_percentage</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Retuns the best <code>save_percentage</code>% <code>params</code> of the simulations given their <code>log_diff</code> with real data.</p>

      <details class="quote">
        <summary>Source code in <code>compartmental/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="k">def</span> <span class="nf">get_best_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">log_diff</span><span class="p">,</span> <span class="n">save_percentage</span><span class="p">):</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="s2">&quot;Retuns the best `save_percentage`% `params` of the simulations given their `log_diff` with real data.&quot;</span> 
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="n">save_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">log_diff</span><span class="o">.</span><span class="n">size</span><span class="o">*</span><span class="n">save_percentage</span><span class="o">*</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">saved_params</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">save_count</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">saved_log_diff</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">save_count</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">CNP</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">if</span> <span class="n">save_count</span> <span class="o">==</span> <span class="n">log_diff</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="n">log_diff_index_sorted</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">log_diff</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="n">log_diff_index_sorted</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">argpartition</span><span class="p">(</span><span class="n">log_diff</span><span class="p">,</span> <span class="n">save_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">save_count</span><span class="p">]</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="n">saved_params</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">log_diff_index_sorted</span><span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="n">saved_log_diff</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">log_diff</span><span class="p">,</span> <span class="n">log_diff_index_sorted</span><span class="p">)</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="k">return</span> <span class="n">saved_params</span><span class="p">,</span> <span class="n">saved_log_diff</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="compartmental.util.get_model_sample_trajectory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_model_sample_trajectory</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Executes the model with <code>n_simulations = 1</code> and <code>n_executions = 1</code>.
Returns all the intermediate states and the parameters.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="compartmental.generic_model.GenericModel" href="../generic_model/#compartmental.generic_model.GenericModel">GenericModel</a></code>
          </td>
          <td><p>Model to execute.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list[list[float]], list[list[float]]</code>
          </td>
          <td><p>Tuple of all states history and corresponding params.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>compartmental/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="k">def</span> <span class="nf">get_model_sample_trajectory</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">GenericModel</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Executes the model with `n_simulations = 1` and `n_executions = 1`.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">    Returns all the intermediate states and the parameters.</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        model (GenericModel): Model to execute.</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        (list[list[float]], list[list[float]]): Tuple of all states history and corresponding params.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="n">reference_mask</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">compartment_name_to_index</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">][</span><span class="s2">&quot;compartments&quot;</span><span class="p">]])</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="n">configuration</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">GenericModel</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="n">inner_model</span> <span class="o">=</span> <span class="n">GenericModel</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">evolve</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evolve</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_simulations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_executions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">populate_model_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">populate_model_compartments</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="n">saved_state</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">inner_model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_steps&quot;</span><span class="p">],</span> <span class="n">inner_model</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">_model_</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">reference_mask</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">_model_</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">_model_</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="n">saved_state</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">_model_</span><span class="o">.</span><span class="n">state</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="k">def</span> <span class="nf">outer</span><span class="p">(</span><span class="n">_model_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="o">...</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">_internal_run_</span><span class="p">(</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="n">inner</span><span class="p">,</span> <span class="p">(</span><span class="n">reference_mask</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">),</span> 
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="n">outer</span><span class="p">,</span> <span class="p">(),</span> 
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">exclude_pupulate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="p">)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="n">offset_array</span><span class="p">(</span><span class="n">saved_state</span><span class="p">,</span> <span class="n">inner_model</span><span class="o">.</span><span class="n">reference_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="k">return</span> <span class="n">saved_state</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">inner_model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="compartmental.util.get_model_sample_trajectory_with_diff_to_reference" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_model_sample_trajectory_with_diff_to_reference</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Executes the model with <code>n_simulations = 1</code> and <code>n_executions = 1</code>.
Returns all the intermediate states and the parameters.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="compartmental.generic_model.GenericModel" href="../generic_model/#compartmental.generic_model.GenericModel">GenericModel</a></code>
          </td>
          <td><p>Model to execute.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reference</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>Reference to compare with.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list[list[float]], list[list[float]], float</code>
          </td>
          <td><p>Tuple of all states history and corresponding params and the difference.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>compartmental/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="k">def</span> <span class="nf">get_model_sample_trajectory_with_diff_to_reference</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">GenericModel</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Executes the model with `n_simulations = 1` and `n_executions = 1`.</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    Returns all the intermediate states and the parameters.</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">        model (GenericModel): Model to execute.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        reference (list): Reference to compare with.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        (list[list[float]], list[list[float]], float): Tuple of all states history and corresponding params and the difference.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="n">reference_mask</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">compartment_name_to_index</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">][</span><span class="s2">&quot;compartments&quot;</span><span class="p">]])</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="n">configuration</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">GenericModel</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="n">inner_model</span> <span class="o">=</span> <span class="n">GenericModel</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">evolve</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evolve</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">reference_mask</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">inner_model</span><span class="o">.</span><span class="n">compartment_name_to_index</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">inner_model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">][</span><span class="s2">&quot;compartments&quot;</span><span class="p">]])</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_simulations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_executions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">N_STEPS</span> <span class="o">=</span> <span class="n">inner_model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_steps&quot;</span><span class="p">]</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">populate_model_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">populate_model_compartments</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="n">saved_state</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">inner_model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_steps&quot;</span><span class="p">],</span> <span class="n">inner_model</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="n">log_diff</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">_model_</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">reference_mask</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="n">_model_</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">_model_</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="n">log_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">inner_model</span><span class="o">.</span><span class="n">get_diff</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">reference_mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="n">saved_state</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">_model_</span><span class="o">.</span><span class="n">state</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="k">def</span> <span class="nf">outer</span><span class="p">(</span><span class="n">_model_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="o">...</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">_internal_run_</span><span class="p">(</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="n">inner</span><span class="p">,</span> <span class="p">(</span><span class="n">reference_mask</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">),</span> 
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="n">outer</span><span class="p">,</span> <span class="p">(),</span> 
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="n">reference</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">exclude_pupulate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="p">)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="n">offset_array</span><span class="p">(</span><span class="n">saved_state</span><span class="p">,</span> <span class="n">inner_model</span><span class="o">.</span><span class="n">reference_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="k">return</span> <span class="n">saved_state</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">inner_model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">log_diff</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="compartmental.util.get_percentiles_from_results" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_percentiles_from_results</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">p_minor</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p_max</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns an array of percentils <code>p_minor=5</code>, median and <code>p_max=95</code> of the given model and results.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="compartmental.generic_model.GenericModel" href="../generic_model/#compartmental.generic_model.GenericModel">GenericModel</a></code>
          </td>
          <td><p>Model used to generate the <code>results</code>.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>results</code></td>
          <td>
                <code>list[list[float]]</code>
          </td>
          <td><p>Result parameters of <code>model</code> execution.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>p_minor</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Smaller percentile. Defaults to 5.</p></td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>p_max</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Bigger percentile. Defaults to 95.</p></td>
          <td>
                <code>95</code>
          </td>
        </tr>
        <tr>
          <td><code>weights</code></td>
          <td>
                <code>list[float] | None</code>
          </td>
          <td><p>Results weights. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list[int, int, list[float]]</code>
          </td>
          <td><p>First index represents the reference defined in <code>reference.compartments</code>.             Second index represents  <code>p_minor</code>, median or <code>p_max=</code>. Final represents the step in the simulation.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>compartmental/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="k">def</span> <span class="nf">get_percentiles_from_results</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">GenericModel</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">p_minor</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">p_max</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns an array of percentils `p_minor=5`, median and `p_max=95` of the given model and results.</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">        model (GenericModel): Model used to generate the `results`.</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">        results (list[list[float]]): Result parameters of `model` execution.</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">        p_minor (int, optional): Smaller percentile. Defaults to 5.</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">        p_max (int, optional): Bigger percentile. Defaults to 95.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">        weights (list[float]|None): Results weights. Defaults to None.</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">        (list[int, int, list[float]]): First index represents the reference defined in `reference.compartments`. \</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">            Second index represents  `p_minor`, median or `p_max=`. Final represents the step in the simulation.</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="n">reference_mask</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">compartment_name_to_index</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">][</span><span class="s2">&quot;compartments&quot;</span><span class="p">]])</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="n">results_no_diff</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>    <span class="n">results_percentiles</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">reference_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_steps&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="n">prev_config</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="n">configuration</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">)</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_simulations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_executions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">GenericModel</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="n">inner_model</span> <span class="o">=</span> <span class="n">GenericModel</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">evolve</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evolve</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">populate_model_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">inner_model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="n">inner_model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">results_no_diff</span><span class="p">[</span><span class="n">inner_model</span><span class="o">.</span><span class="n">param_to_index</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">populate_model_compartments</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="n">storage</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_steps&quot;</span><span class="p">],</span> <span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_simulations&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>    <span class="n">_range</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_simulations&quot;</span><span class="p">])</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">_model_</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">reference_mask</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="n">_model_</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">_model_</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="n">aux</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">_model_</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">reference_mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="c1"># TODO: improve this so that storage is not bigger than (offset.max - offset.min, n_simulations) </span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="c1"># This line is a bit complex, what it does:</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="c1"># Save in the storage at the correct time for each simulation the values of the aux (=values of state to compare with reference) </span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="c1"># in the same order so that each simulation is treated independently until all simulations stop</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="n">storage</span><span class="p">[</span><span class="n">CNP</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_model_</span><span class="o">.</span><span class="n">reference_offset</span> <span class="o">+</span> <span class="n">step</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_model_</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_steps&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>             <span class="n">_range</span><span class="p">]</span> <span class="o">+=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">_range</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">_model_</span><span class="o">.</span><span class="n">reference_offset</span> <span class="o">+</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="n">_model_</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_steps&quot;</span><span class="p">])</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="k">def</span> <span class="nf">outer</span><span class="p">(</span><span class="n">_model_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="o">...</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="n">inner_model</span><span class="o">.</span><span class="n">_internal_run_</span><span class="p">(</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="n">inner</span><span class="p">,</span> <span class="p">(</span><span class="n">reference_mask</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">),</span> 
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="n">outer</span><span class="p">,</span> <span class="p">(),</span> 
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">exclude_pupulate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">percentile</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">p</span><span class="p">:</span> <span class="n">weighted_quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="n">percentile</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">p</span><span class="p">:</span> <span class="n">CNP</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_steps&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="n">sort</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">storage</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="n">results_percentiles</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="p">]</span> <span class="o">+=</span> <span class="n">percentile</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="n">p_minor</span><span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="n">results_percentiles</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="p">]</span> <span class="o">+=</span> <span class="n">percentile</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="n">results_percentiles</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">step</span><span class="p">]</span> <span class="o">+=</span> <span class="n">percentile</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="n">p_max</span><span class="p">)</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="k">return</span> <span class="n">results_percentiles</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="compartmental.util.get_trajecty_selector" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_trajecty_selector</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">show_only_reference</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Creates an interactive plot and histograms of results. When a histogram is clicked the value of
that parameter changes to the selected value.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="compartmental.generic_model.GenericModel" href="../generic_model/#compartmental.generic_model.GenericModel">GenericModel</a></code>
          </td>
          <td><p>Model used for the trajectory.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>results</code></td>
          <td>
                <code>list[list[float]]</code>
          </td>
          <td><p>Results from running the model.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>weights</code></td>
          <td>
                <code>list[float]</code>
          </td>
          <td><p>Results weights. Defaults to None.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reference</code></td>
          <td>
                <code>list[list[float]]</code>
          </td>
          <td><p>If give, is printed to the trajectory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>show_only_reference</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>If <code>True</code> only the values used to compare with the reference are ploted. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict[str, float]</code>
          </td>
          <td><p>Dictionary with the manually selected params.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>compartmental/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="k">def</span> <span class="nf">get_trajecty_selector</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">GenericModel</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">show_only_reference</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates an interactive plot and histograms of results. When a histogram is clicked the value of</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">    that parameter changes to the selected value.</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">        model (GenericModel): Model used for the trajectory.</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">        results (list[list[float]]): Results from running the model.</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">        weights (list[float], optional): Results weights. Defaults to None.</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">        reference (list[list[float]], optional): If give, is printed to the trajectory. Defaults to None.</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">        show_only_reference (boolean, optional): If `True` only the values used to compare with the reference are ploted. Defaults to False.</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">        (dict[str, float]): Dictionary with the manually selected params.</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="n">prev_config</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="n">fig_sample</span><span class="p">,</span> <span class="n">ax_sample</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="n">_range</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;n_steps&quot;</span><span class="p">])</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="c1"># Params used for the trajectory are saved here. This is returned</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="n">compartments_ploted</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="n">fig</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">param_to_index</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="n">_5</span><span class="p">,</span> <span class="n">_50</span><span class="p">,</span> <span class="n">_95</span> <span class="o">=</span> <span class="n">weighted_quantile</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">95</span><span class="p">],</span> <span class="n">weights</span><span class="p">)</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">_5</span><span class="p">,</span> <span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">_50</span><span class="p">,</span> <span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">_95</span><span class="p">,</span> <span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="s1">&#39;purple&#39;</span><span class="p">)</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>        <span class="n">line</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([(</span><span class="n">_5</span><span class="o">+</span><span class="n">_50</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">_5</span><span class="o">+</span><span class="n">_50</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="p">],</span>  <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>        <span class="n">values</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">p</span><span class="p">:(</span><span class="n">_5</span><span class="o">+</span><span class="n">_50</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">})</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="c1"># Define a picker por the param ax</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="k">def</span> <span class="nf">picker_builder</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">vline</span><span class="p">):</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="k">def</span> <span class="nf">picker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>                <span class="c1"># Update values and vline xdata</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>                <span class="n">values</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">param</span><span class="p">:</span><span class="n">x</span><span class="p">})</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>                <span class="n">vline</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">])</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                <span class="c1"># Update trajectory</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>                <span class="n">data</span><span class="p">,</span> <span class="n">diff</span> <span class="o">=</span> <span class="n">update</span><span class="p">()</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;diff=</span><span class="si">{</span><span class="n">diff</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>                <span class="k">for</span> <span class="n">compartment</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">compartments_ploted</span><span class="p">,</span> <span class="n">sample_lines</span><span class="p">):</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                    <span class="k">if</span> <span class="n">show_only_reference</span> <span class="ow">and</span> <span class="n">reference</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>                        <span class="k">continue</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>                        <span class="n">line</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">compartment_name_to_index</span><span class="p">[</span><span class="n">compartment</span><span class="p">]])</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>                <span class="n">fig_sample</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>                <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">{}</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="k">return</span> <span class="n">picker</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="n">line</span><span class="o">.</span><span class="n">set_picker</span><span class="p">(</span><span class="n">picker_builder</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">():</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="n">sample</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">diff</span> <span class="o">=</span> <span class="n">get_model_sample_trajectory_with_diff_to_reference</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">values</span><span class="p">)</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>        <span class="k">return</span> <span class="n">sample</span><span class="p">,</span> <span class="n">diff</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="n">sample</span><span class="p">,</span> <span class="n">diff</span> <span class="o">=</span> <span class="n">update</span><span class="p">()</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="n">list_of_sample_lines</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="k">if</span> <span class="n">show_only_reference</span> <span class="ow">and</span> <span class="n">reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">compartment_name_to_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;reference&quot;</span><span class="p">][</span><span class="s2">&quot;compartments&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>                    <span class="n">compartments_ploted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>                    <span class="n">list_of_sample_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_range</span><span class="p">)</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>                    <span class="n">list_of_sample_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>                    <span class="n">list_of_sample_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="k">else</span><span class="p">:</span> 
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>            <span class="k">raise</span> <span class="ne">KeyError</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="n">compartments_ploted</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">compartment_name_to_index</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sample</span><span class="p">:</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>            <span class="n">list_of_sample_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_range</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="n">list_of_sample_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="n">list_of_sample_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="n">sample_lines</span> <span class="o">=</span> <span class="n">ax_sample</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_sample_lines</span><span class="p">)</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>    <span class="k">if</span> <span class="n">reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="n">ax_sample</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">_range</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="n">model</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">prev_config</span><span class="p">)</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="compartmental.util.load_parameters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_parameters</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Loads parameters from file with the same format as <code>save_parameters</code> and <code>save_parameters_no_diff</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Filename or path to file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list[list[float]]</code>
          </td>
          <td><p>Parameters array. First index selects the column (parameter).</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>compartmental/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="k">def</span> <span class="nf">load_parameters</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads parameters from file with the same format as `save_parameters` and `save_parameters_no_diff`.</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        file (str): Filename or path to file.</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        (list[list[float]]): Parameters array. First index selects the column (parameter).</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_in</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file_in</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="k">return</span> <span class="n">CNP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="compartmental.util.offset_array" class="doc doc-heading">
<code class="highlight language-python"><span class="n">offset_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Offsets an array by the given amount.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>array</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>array to be changed.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>offset</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>offset to apply to the given array.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>compartmental/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="k">def</span> <span class="nf">offset_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Offsets an array by the given amount.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        array (list): array to be changed.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        offset (int): offset to apply to the given array.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="n">array</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:</span><span class="o">-</span><span class="n">offset</span><span class="p">]</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="n">array</span><span class="p">[:</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="k">elif</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="n">array</span><span class="p">[:</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="n">offset</span><span class="p">:]</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="n">array</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">offset</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="compartmental.util.progress_bar" class="doc doc-heading">
<code class="highlight language-python"><span class="n">progress_bar</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sufix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Prints a progress bar on standar output.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Prefix to the progress bar.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>progress</code></td>
          <td>
                <code>int | float</code>
          </td>
          <td><p>Progress value.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>total</code></td>
          <td>
                <code>int | float</code>
          </td>
          <td><p>Total progess posible.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sufix</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Sufix to the progess bar. Defaults to "".</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>end</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>End value, set to <code>\n</code> at the end. Defaults to '
'.</p></td>
          <td>
                <code>&#39;\r&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>len</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Length of progress bar. Defaults to 10.</p></td>
          <td>
                <code>10</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>compartmental/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="k">def</span> <span class="nf">progress_bar</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sufix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Prints a progress bar on standar output.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        prefix (str): Prefix to the progress bar.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        progress (int|float): Progress value.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        total (int|float): Total progess posible.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        sufix (str, optional): Sufix to the progess bar. Defaults to &quot;&quot;.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        end (str, optional): End value, set to `\\n` at the end. Defaults to &#39;\r&#39;.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        len (int, optional): Length of progress bar. Defaults to 10.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">per</span> <span class="o">=</span> <span class="nb">len</span> <span class="o">*</span> <span class="n">progress</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> -&gt; ||</span><span class="si">{</span><span class="s1">&#39;▮&#39;</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">per</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;▯&#39;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">per</span><span class="p">))</span><span class="si">}</span><span class="s2"> ||</span><span class="si">{</span><span class="n">per</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="nb">len</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%  </span><span class="si">{</span><span class="n">sufix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="compartmental.util.save_parameters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save_parameters</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">params_names</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">log_diff</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">execution_number</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Saves the parameters with the given names including the diff column.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Filename or path to file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>params_names</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>Name of parameters.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>params</code></td>
          <td>
                <code>list[list[float]]</code>
          </td>
          <td><p>Parameters array.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>log_diff</code></td>
          <td>
                <code>list[float]</code>
          </td>
          <td><p>Diff array.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>execution_number</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of the execution. If <code>0</code> the header is printed. Defaults to 0.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>compartmental/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="k">def</span> <span class="nf">save_parameters</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="n">log_diff</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">execution_number</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Saves the parameters with the given names including the diff column.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        file (str): Filename or path to file.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        params_names (list[str]): Name of parameters.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        params (list[list[float]]): Parameters array.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        log_diff (list[float]): Diff array.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        execution_number (int, optional): Number of the execution. If `0` the header is printed. Defaults to 0.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span> <span class="k">if</span> <span class="n">execution_number</span><span class="o">!=</span><span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_out</span><span class="p">:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="c1"># TODO: check for cupy</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="c1"># import numpy as np</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="kn">import</span> <span class="nn">regex</span> <span class="k">as</span> <span class="nn">re</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="c1"># if np != CNP:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="c1">#     np.savetxt(file_out, CNP.asnumpy(CNP.concatenate((log_diff, params), 1)) , delimiter=&#39;,&#39;, comments=&#39;&#39;, header=&quot;,&quot;.join([&quot;log_diff&quot;, *params_names]) if execution_number==0 else &quot;&quot;)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="c1"># else:</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">_log_diff</span> <span class="o">=</span> <span class="n">log_diff</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">_params</span> <span class="o">=</span> <span class="n">params</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">_log_diff</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">log_diff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;log_diff&quot;</span><span class="p">,</span> <span class="n">CNP</span><span class="o">.</span><span class="n">float64</span><span class="p">)])</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">_merged</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">_params</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="n">_log_diff</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">descr</span><span class="p">,</span> <span class="o">*</span><span class="n">_params</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">descr</span><span class="p">])</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="n">_merged</span><span class="p">[</span><span class="s2">&quot;log_diff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_log_diff</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_params</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="n">_merged</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="k">if</span> <span class="n">execution_number</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_merged</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>            <span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[|\]|\(|\)| &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">CNP</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">_merged</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="compartmental.util.save_parameters_no_diff" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save_parameters_no_diff</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">params_names</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">execution_number</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Saves the parameters with the given names without the diff column.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Filename or path to file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>params_names</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>Name of parameters.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>params</code></td>
          <td>
                <code>list[list[float]]</code>
          </td>
          <td><p>Parameters array.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>execution_number</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of the execution. If <code>0</code> the header is printed. Defaults to 0.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>compartmental/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="k">def</span> <span class="nf">save_parameters_no_diff</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="o">*</span><span class="p">,</span> <span class="n">execution_number</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Saves the parameters with the given names without the diff column.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        file (str): Filename or path to file.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        params_names (list[str]): Name of parameters.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        params (list[list[float]]): Parameters array.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        execution_number (int, optional): Number of the execution. If `0` the header is printed. Defaults to 0.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span> <span class="k">if</span> <span class="n">execution_number</span><span class="o">!=</span><span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_out</span><span class="p">:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="c1"># import numpy as np</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="c1"># if np != CNP:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="c1">#     _params = CNP.asnumpy(params)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="c1"># else:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="c1">#     _params = params</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="c1"># np.savetxt(file_out, params.T, delimiter=&#39;,&#39;, comments=&#39;&#39;, header=&quot;,&quot;.join(params_names) if execution_number==0 else &quot;&quot;)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="kn">import</span> <span class="nn">regex</span> <span class="k">as</span> <span class="nn">re</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">_merged</span> <span class="o">=</span> <span class="n">params</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_merged</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[|\]|\(|\)| &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">CNP</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">_merged</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="compartmental.util.weighted_quantile" class="doc doc-heading">
<code class="highlight language-python"><span class="n">weighted_quantile</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">quantiles</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">values_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">old_style</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>From: https://stackoverflow.com/a/29677616</p>
<p>Very close to numpy.percentile, but supports weights.
NOTE: quantiles should be in [0, 100]!</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>values</code></td>
          <td>
                <code>list[float]</code>
          </td>
          <td><p>Array with data.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>quantiles</code></td>
          <td>
                <code>list[float]</code>
          </td>
          <td><p>Array with many quantiles needed.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sample_weight</code></td>
          <td>
                <code>list[float]</code>
          </td>
          <td><p>Array of the same length as <code>array</code>. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>values_sorted</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, then will avoid sorting of initial array.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>old_style</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, will correct output to be consistent with numpy.percentile.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list[float]</code>
          </td>
          <td><p>Array with computed quantiles.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>compartmental/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="k">def</span> <span class="nf">weighted_quantile</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">quantiles</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">values_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">old_style</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;From: https://stackoverflow.com/a/29677616</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    Very close to numpy.percentile, but supports weights.</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    NOTE: quantiles should be in [0, 100]!</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        values (list[float]): Array with data.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        quantiles (list[float]): Array with many quantiles needed.</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        sample_weight (list[float], optional): Array of the same length as `array`. Defaults to None.</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        values_sorted (bool): If True, then will avoid sorting of initial array.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        old_style (bool): If True, will correct output to be consistent with numpy.percentile.</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">        (list[float]): Array with computed quantiles.</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>    <span class="n">quantiles</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">quantiles</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">CNP</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="n">quantiles</span> <span class="o">/=</span> <span class="mf">100.</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="k">if</span> <span class="n">sample_weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">sample_weight</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="n">sample_weight</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sample_weight</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">values_sorted</span><span class="p">:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="n">sorter</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="n">values</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">sorter</span><span class="p">])</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="n">sample_weight</span> <span class="o">=</span> <span class="n">sample_weight</span><span class="p">[</span><span class="n">sorter</span><span class="p">]</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="n">weighted_quantiles</span> <span class="o">=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">sample_weight</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sample_weight</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="k">if</span> <span class="n">old_style</span><span class="p">:</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="c1"># To be convenient with numpy.percentile</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="n">weighted_quantiles</span> <span class="o">-=</span> <span class="n">weighted_quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="n">weighted_quantiles</span> <span class="o">/=</span> <span class="n">weighted_quantiles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="n">weighted_quantiles</span> <span class="o">/=</span> <span class="n">CNP</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sample_weight</span><span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="k">return</span> <span class="n">CNP</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">quantiles</span><span class="p">,</span> <span class="n">weighted_quantiles</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.51198bba.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>